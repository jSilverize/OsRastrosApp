"use strict";angular.module("rastros",["ngRoute","duScroll","aphrodite"]),angular.module("rastros").config(["$routeProvider","momentProvider",function(e,t){t.locale("pt-br"),e.when("/",{templateUrl:"app/templates/home-template.html",controller:"HomeController",authPage:!1,authenticated:!1}).when("/404",{templateUrl:"app/templates/404-template.html",controller:"404Controller",authPage:!1,authenticated:!1}).when("/entrar",{templateUrl:"app/templates/auth-login-template.html",controller:"AuthController",authPage:!0,authenticated:!1}).when("/cadastrar",{templateUrl:"app/templates/auth-register-template.html",controller:"AuthController",authPage:!0,authenticated:!1}).when("/perfil",{templateUrl:"app/templates/profile-template.html",controller:"ProfileController",authPage:!1,authenticated:!0}).otherwise({redirectTo:"/404"})}]),angular.module("rastros").run(["$rootScope","routeChange","flow",function(e,t,a){e.$on("$routeChangeError",t.error),e.$on("$routeChangeStart",t.start),e.$on("$routeChangeSuccess",t.success),a.ls.getItem("lastPath")||a.ls.setItem("lastPath","/")}]),function(){angular.module("rastros").run(["$templateCache",function(e){e.put("app/templates/404-template.html",' <header class="header"> <div class="aph container"> <h1 class="header__title aph support text-center"> 404 </h1> </div> </header> <section class="section"> <div class="container"> <h1 class="aph section__title"> Caminho ou página não encontrada </h1> <p class="aph"> Você tentou acessar algo que não tá aqui com nóis não, fi. </p> <p class="aph"> Pode tentar de novo, se quiser. </p> <br> <button class="aph btn btn--black" data-ng-click="goBack();"> Voltar </button> </div> </section>'),e.put("app/templates/auth-login-template.html",' <header class="header"> <div class="aph container"> <h1 class="header__title aph support text-center"> Entrar </h1> </div> </header> <section class="section"> <div class="aph container"> <div class="row center-xs center-sm center-md center-lg"> <div class="col-xs-12 col-sm-5 col-md-4 col-lg-3"> <form class="aph form form--with-fields" name="loginForm" novalidate data-form-validation="loginForm" data-ng-submit="loginForm.$valid && login();"> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--facebook" type="button" data-ng-click="facebook();"> ENTRAR COM FACEBOOK </button> </div> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--twitter" type="button" data-ng-click="twitter();"> ENTRAR COM TWITTER </button> </div> <div class="aph form__field form__field--large form__or text-center"> OU ENTÃO </div> <div class="aph form__field"> <label class="aph form__label" for="email"> E-mail* </label> <input class="aph form__control" type="email" name="email" id="email" data-ng-required="true" data-ng-model="form.email"> <div class="aph form__helper form__helper--error" data-ng-show="loginForm[\'email\'].$invalid && !loginForm[\'email\'].$pristine"> Preencha com um e-mail válido </div> </div> <div class="aph form__field"> <label class="aph form__label" for="password"> Senha* </label> <input class="aph form__control" type="password" name="password" id="password" data-ng-required="true" data-ng-model="form.password"> <div class="aph form__helper form__helper--error" data-ng-show="loginForm[\'password\'].$invalid && !loginForm[\'password\'].$pristine"> Insira sua senha </div> </div> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--green" type="submit" data-ng-disabled="!form.email || !form.password"> ENTRAR </button> </div> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--bordered btn--yellow" type="button" data-ng-disabled="loginForm[\'email\'].$invalid || sentResetPassowrd" data-ng-click="forgetPassword(); sentResetPassowrd = true;"> ESQUECI A SENHA </button> </div> </form> </div> </div> </div> </section>'),e.put("app/templates/auth-register-template.html",' <header class="header"> <div class="aph container"> <h1 class="header__title aph support text-center"> Cadastrar </h1> </div> </header> <section class="section"> <div class="aph container"> <div class="row center-xs center-sm center-md center-lg"> <div class="col-xs-12 col-sm-5 col-md-4 col-lg-3"> <form class="aph form form--with-fields" name="registerForm" novalidate data-form-validation="registerForm" data-ng-submit="registerForm.$valid && register();"> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--facebook" type="button" data-ng-click="facebook()"> CADASTRAR COM FACEBOOK </button> </div> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--twitter" type="button" data-ng-click="twitter()"> CADASTRAR COM TWITTER </button> </div> <div class="aph form__field form__field--large form__or text-center"> OU ENTÃO </div> <div class="aph form__field"> <label class="aph form__label" for="email"> E-mail* </label> <input class="aph form__control" type="email" name="email" id="email" data-ng-required="true" data-ng-model="form.email" autocomplete="off"> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'email\'].$invalid && !registerForm[\'email\'].$pristine"> Preencha com um e-mail válido </div> </div> <div class="aph form__field"> <label class="aph form__label" for="emailCheck"> Confirmar Email* </label> <input class="aph form__control" type="email" name="emailCheck" id="emailCheck" data-ng-match="form.email" data-ng-required="true" data-ng-model="form.emailCheck" autocomplete="off"> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'emailCheck\'].$invalid && !registerForm[\'emailCheck\'].$pristine"> Repita o e-mail correspondente </div> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'email\'].$valid && form.email !== form.emailCheck && !registerForm[\'emailCheck\'].$pristine && registerForm[\'emailCheck\'].$valid"> Os e-mails não estão iguais </div> </div> <div class="aph form__field"> <label class="aph form__label" for="password"> Senha* </label> <input class="aph form__control" type="password" name="password" id="password" data-ng-required="true" data-ng-model="form.password"> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'password\'].$invalid && !registerForm[\'password\'].$pristine"> Insira uma senha </div> </div> <div class="aph form__field"> <label class="aph form__label" for="passwordCheck"> Confirmar Senha* </label> <input class="aph form__control" type="password" name="passwordCheck" id="passwordCheck" data-ng-match="form.password" data-ng-required="true" data-ng-model="form.passwordCheck"> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'passwordCheck\'].$invalid && !registerForm[\'passwordCheck\'].$pristine"> Repita a senha correspondente </div> <div class="aph form__helper form__helper--error" data-ng-show="registerForm[\'password\'].$valid && form.password !== form.passwordCheck && !registerForm[\'passwordCheck\'].$pristine && registerForm[\'passwordCheck\'].$valid"> A senha não está igual </div> </div> <div class="aph form__field form__field--large"> <button class="aph btn btn--block btn--green" type="submit" data-ng-disabled="!form.email || !form.password || !form.passwordCheck || form.password !== form.passwordCheck || registerForm.$submitted"> CADASTRAR </button> </div> </form> </div> </div> </div> </section> '),e.put("app/templates/home-template.html",'<header class="lion"> </header> <section class="section"> <div class="aph container" data-ng-if="nextMatches"> <h1 class="aph support"> <span data-ng-if="nextMatches"> Próximos Jogos </span> </h1> <div class="row center-sm center-md center-lg"> <div class="col-xs-12 col-sm-6 col-md-4" data-ng-repeat="match in nextMatches"> <div data-ng-init="goingCount(match)"></div> <div class="match"> <div class="match__date"> <div class="match__date__weekday"> {{ match.date.moment.format(\'dddd\') }} </div> <div class="match__date__fulldate"> {{ match.date.moment.format(\'DD [de] MMMM [de] YYYY\') }} </div> <div class="match__date__time"> {{ match.date.moment.format(\'HH:mm\') }} </div> </div> <div class="match__teams"> <div class="match__team"> <img class="match__team__logo" data-ng-src="{{ match.teams.home.logo }}" data-error-src="{{ match.teams.home.logoOld }}"> {{ match.teams.home.title }} </div> <div class="match__versus">×</div> <div class="match__team"> <img class="match__team__logo" data-ng-src="{{ match.teams.visitor.logo }}" data-error-src="{{ match.teams.visitor.logoOld }}"> {{ match.teams.visitor.title }} </div> </div> <div class="match__footer"> <div class="match__going"> <div class="match__going__text"> <ng-pluralize count="match.goingNumber" when="{\n\t\t\t\t\t\t\t\t\t\t\'0\'    : \'Ninguém confirmou ainda. Bora?\',\n\t\t\t\t\t\t\t\t\t\t\'one\'  : \'1 pessoa falou que vai, hein?!\',\n\t                     \t\t\t\t\'other\': \'{} pessoas confirmaram presença\'\n\t                     \t\t\t}"> </ng-pluralize> </div> <div class="match__going__users"> <img class="match__going__users__avatar" data-ng-repeat="people in match.goingProfiles" title="{{ people.name }}" alt="{{ people.name }}" data-ng-src="{{ people.photoURL }}"> <button class="match__going__users__avatar" data-ng-show="!match.goingProfiles || match.goingProfiles.length === 0" title="Confirmar presença?" data-ng-click="imGoing(match);"> </button> </div> </div> <div class="row"> <div class="col-xs-6"> <a class="aph btn btn--small btn--block btn--link btn--black" target="_blank" title="Ver no site da Futliga" href="{{ detailsUrl + match.date.id + \'/\' + match.id }}#confronto-mapa"> Local </a> </div> <div class="col-xs-6"> <button class="aph btn btn--small btn--block btn--link btn--green" data-ng-click="imGoing(match);" data-ng-show="!match.imGoing"> Vou colar! </button> <button class="aph btn btn--small btn--block btn--link btn--red" data-ng-click="imNotGoing(match);" data-ng-show="match.imGoing && user.uid"> Não vou + </button> </div> </div> </div> </div> </div> </div> </div> <div class="aph container" data-ng-if="!nextMatches"> <h1 class="aph support"> É, dom... </h1> <p class="aph"> Deu ruim tentando carregar os próximos jogos da futliga. </p> <p class="aph"> Mas acontece, falaê?! </p> </div> </section> '),e.put("app/templates/profile-template.html",'<header class="header header--no-mb"> <div class="aph container text-center"> <h1 class="aph header__title"> Meu perfil </h1> </div> </header> <section class="profile"> <div class="aph container"> <div class="row bottom-sm bottom-md bottom-lg"> <div class="col-xs-12 col-sm-2 col-md-1"> <figure class="profile__avatar"> <img class="profile__avatar__picture aph img-responsive" data-ng-src="{{ profile.photoURL }}" data-ng-if="profile.photoURL"> <img class="profile__avatar__picture aph img-responsive" data-ng-src="./assets/images/os-rastros.gif" data-ng-if="!profile.photoURL"> </figure> </div> <div class="col-xs-12 col-sm-4 col-md-4 col-lg-3 profile__info"> <div class="profile__info__item" title="{{ profile.displayName || profile.email }}"> <div class="profile__info__item__label"> <span data-ng-if="profile.displayName"> Nome </span> <span data-ng-if="!profile.displayName"> E-mail </span> </div> {{ profile.displayName || profile.email }} </div> </div> <div class="col-xs-12 col-sm-3 col-md-4 col-lg-6 profile__info"> <div class="profile__info__item" data-ng-if="profile.email && profile.displayName" title="{{ profile.email }}"> <div class="profile__info__item__label"> E-mail </div> {{ profile.email }} </div> </div> <div class="col-xs-12 col-sm-3 col-md-3 col-lg-2" title="EM CONTRUÇÃO"> <button class="aph btn btn--block btn--green" type="button" data-ng-click="edit();" data-ng-disabled="true"> Editar Perfil </button> </div> </div> </div> </section> '),e.put("app/templates/directives/loader-directive-template.html",'<div class="loader" data-ng-hide="activities.length === 0 && errors.length === 0"> <div class="loader__content"> <div class="venus container"> <figure class="loader__content__spinner" data-ng-show="activities.length !== 0 && errors.length === 0"> <img class="loader__content__spinner__image" data-ng-src="./assets/images/loader--spinner.gif" alt="Loading"> </figure> <div class="loader__content__message" data-ng-repeat="activity in activities"> <div data-ng-if="!activity.title && !activity.text" data-ng-bind-html="activity | unsafe"> </div> <div class="loader__content__message__title" data-ng-if="activity.title" data-ng-bind-html="activity.title | unsafe"> </div> <div class="loader__content__message__text" data-ng-if="activity.text" data-ng-bind-html="activity.text | unsafe"> </div> </div> <div class="loader__content__error" data-ng-repeat="error in errors"> <div data-ng-bind-html="error | unsafe"></div> <button class="loader__content__error__icon" data-ng-click="clearError(error)"> × </button> </div> </div> </div> </div> '),e.put("app/templates/directives/navbar-directive-template.html",'<div class="aph container"> <div class="aph navbar__nav"> <a class="aph navbar__brand" data-ng-click="goTo(\'/\');" title="Início"> <span class="aph navbar__brand__logo"></span> <span class="aph navbar__brand__title"> Os Rastros </span> </a> <ul class="aph navbar__menu navbar__menu--right list"> <li class="aph list__item" data-ng-if="!user"> <a class="aph list__item__link" data-ng-click="goTo(\'/cadastrar\')"> Cadastrar </a> </li> <li class="aph list__item" data-ng-if="!user"> <a class="aph btn btn--green" data-ng-click="goTo(\'/entrar\')"> Entrar </a> </li> <li class="aph list__item dropdown dropdown--right" data-ng-if="user" data-dropdown data-click-outside="closeDropdown();" aria-label="{{ user.displayName || user.email }}"> <img class="aph navbar__menu__user__avatar" height="32" width="32" alt="{{ user.displayName || user.email }}" data-ng-if="user.photoURL" data-ng-src="{{ user.photoURL }}"> <a class="aph list__item__link navbar__menu__user dropdown__toggle"> {{ user.displayName || user.email }} </a> <ul class="aph dropdown__content"> <li class="aph dropdown__content__item"> <a class="aph dropdown__content__item__link" data-ng-click="goTo(\'/perfil\');"> Meu Perfil </a> </li> <li class="aph dropdown__content__item"> <a class="aph dropdown__content__item__link" data-ng-click="logout();"> Sair </a> </li> </ul> </li> </ul> <label class="aph navbar__menu__drawer" for="drawer-default" data-drawer="drawer-default-menu"> <input class="aph navbar__menu__drawer__checkbox" type="checkbox" name="drawer-default" id="drawer-default" data-click-outside="closeDrawer();" data-outside-if-not="drawer-default-menu"> </label> </div> </div> <div class="aph drawer" id="drawer-default-menu"> <ul class="aph list drawer__menu"> <li class="aph list__header"> OS RASTROS </li> <li class="aph list__item"> <a class="aph list__item__link" data-ng-click="goTo(); closeDrawer();"> Início </a> </li> </ul> <ul class="aph list drawer__menu"> <li class="aph list__item text-black" data-ng-if="user"> <a class="aph list__item__link drawer__menu__user" data-ng-click="goTo(\'/perfil\'); closeDrawer();"> <img class="aph drawer__menu__user__avatar" height="32" width="32" alt="{{ user.displayName || user.email }}" data-ng-if="user.photoURL" data-ng-src="{{ user.photoURL }}"> {{ user.displayName || user.email }} </a> </li> <li class="aph list__item"> <a class="aph btn btn--green btn--block btn--small" data-ng-click="goTo(\'/entrar\'); closeDrawer();" data-ng-if="!user"> ENTRAR </a> <a class="aph btn btn--green btn--block btn--bordered btn--small" data-ng-click="goTo(\'/cadastrar\'); closeDrawer();" data-ng-if="!user"> CADASTRAR </a> <a class="aph btn btn--green btn--small btn--bordered btn--block" data-ng-click="logout(); closeDrawer();" data-ng-if="user"> SAIR </a> </li> </ul> </div> '),e.put("app/templates/directives/loader-directive-template.html",'<div class="loader" data-ng-hide="activities.length === 0 && errors.length === 0"> <div class="loader__content"> <div class="venus container"> <figure class="loader__content__spinner" data-ng-show="activities.length !== 0 && errors.length === 0"> <img class="loader__content__spinner__image" data-ng-src="./assets/images/loader--spinner.gif" alt="Loading"> </figure> <div class="loader__content__message" data-ng-repeat="activity in activities"> <div data-ng-if="!activity.title && !activity.text" data-ng-bind-html="activity | unsafe"> </div> <div class="loader__content__message__title" data-ng-if="activity.title" data-ng-bind-html="activity.title | unsafe"> </div> <div class="loader__content__message__text" data-ng-if="activity.text" data-ng-bind-html="activity.text | unsafe"> </div> </div> <div class="loader__content__error" data-ng-repeat="error in errors"> <div data-ng-bind-html="error | unsafe"></div> <button class="loader__content__error__icon" data-ng-click="clearError(error)"> × </button> </div> </div> </div> </div> '),e.put("app/templates/directives/navbar-directive-template.html",'<div class="aph container"> <div class="aph navbar__nav"> <a class="aph navbar__brand" data-ng-click="goTo(\'/\');" title="Início"> <span class="aph navbar__brand__logo"></span> <span class="aph navbar__brand__title"> Os Rastros </span> </a> <ul class="aph navbar__menu navbar__menu--right list"> <li class="aph list__item" data-ng-if="!user"> <a class="aph list__item__link" data-ng-click="goTo(\'/cadastrar\')"> Cadastrar </a> </li> <li class="aph list__item" data-ng-if="!user"> <a class="aph btn btn--green" data-ng-click="goTo(\'/entrar\')"> Entrar </a> </li> <li class="aph list__item dropdown dropdown--right" data-ng-if="user" data-dropdown data-click-outside="closeDropdown();" aria-label="{{ user.displayName || user.email }}"> <img class="aph navbar__menu__user__avatar" height="32" width="32" alt="{{ user.displayName || user.email }}" data-ng-if="user.photoURL" data-ng-src="{{ user.photoURL }}"> <a class="aph list__item__link navbar__menu__user dropdown__toggle"> {{ user.displayName || user.email }} </a> <ul class="aph dropdown__content"> <li class="aph dropdown__content__item"> <a class="aph dropdown__content__item__link" data-ng-click="goTo(\'/perfil\');"> Meu Perfil </a> </li> <li class="aph dropdown__content__item"> <a class="aph dropdown__content__item__link" data-ng-click="logout();"> Sair </a> </li> </ul> </li> </ul> <label class="aph navbar__menu__drawer" for="drawer-default" data-drawer="drawer-default-menu"> <input class="aph navbar__menu__drawer__checkbox" type="checkbox" name="drawer-default" id="drawer-default" data-click-outside="closeDrawer();" data-outside-if-not="drawer-default-menu"> </label> </div> </div> <div class="aph drawer" id="drawer-default-menu"> <ul class="aph list drawer__menu"> <li class="aph list__header"> OS RASTROS </li> <li class="aph list__item"> <a class="aph list__item__link" data-ng-click="goTo(); closeDrawer();"> Início </a> </li> </ul> <ul class="aph list drawer__menu"> <li class="aph list__item text-black" data-ng-if="user"> <a class="aph list__item__link drawer__menu__user" data-ng-click="goTo(\'/perfil\'); closeDrawer();"> <img class="aph drawer__menu__user__avatar" height="32" width="32" alt="{{ user.displayName || user.email }}" data-ng-if="user.photoURL" data-ng-src="{{ user.photoURL }}"> {{ user.displayName || user.email }} </a> </li> <li class="aph list__item"> <a class="aph btn btn--green btn--block btn--small" data-ng-click="goTo(\'/entrar\'); closeDrawer();" data-ng-if="!user"> ENTRAR </a> <a class="aph btn btn--green btn--block btn--bordered btn--small" data-ng-click="goTo(\'/cadastrar\'); closeDrawer();" data-ng-if="!user"> CADASTRAR </a> <a class="aph btn btn--green btn--small btn--bordered btn--block" data-ng-click="logout(); closeDrawer();" data-ng-if="user"> SAIR </a> </li> </ul> </div> ')}])}(),angular.module("rastros").constant("config",{FACEBOOK:{APP_ID:"100871850338155",SCOPE:"email,user_friends,user_birthday,user_location",SDK:"//connect.facebook.net/pt_BR/sdk.js",ERROR:{CODE:"fb-not-loaded",MSG:"Não foi possível carregar o serviço de autenticação do Facebook. Vamos tentar reestabelecer a conexão. Tente novamente em alguns segundos."}}}),angular.module("rastros").constant("urls",{CORS:"https://cors-anywhere.herokuapp.com/",FUTLIGA:{INDEX:"https://futliga.com.br/",IMAGES_PATH:"imagens/distintivos/",AGENDA_PATH:"Agenda/",NEXT_MATCHES:"futliga/associado/equipes/associado-equipes-obter-agenda.asp?hidEquipe=8985&hidPagina=1"}}),angular.module("rastros").factory("routeChange",["$rootScope","$document","$timeout","$location","flow","scroll","loader",function(e,t,a,o,i,n,s){var r={},l="Carregando...";return r.start=function(){s.start(l)},r.success=function(e,t){n.toTop(),firebase.auth().onAuthStateChanged(function(e){t.$$route.authenticated&&!e&&i.goTo("/entrar",o.path()),t.$$route.authPage&&e&&i.goTo("/perfil",o.path()),a(function(){s.stop(l)},800)})},r.error=function(e){s.stop(l),a(function(){s.error('<strong>VISH</strong>!<br />Isso aqui deu errado:<br />"'+e.name+'"')},1e3),i.goBack()},r}]),angular.module("rastros").factory("flow",["$filter","$location","$route","$window",function(e,t,a,o){var i={ls:o.localStorage,lastPath:null};return i.goTo=function(e,a){var o=e||"/",n=["/404","/entrar","/cadastrar","/perfil"];a=a?a:t.path(),a&&n.indexOf(a)===-1&&i.ls.setItem("lastPath",a),t.path(o)},i.goBack=function(){var e=i.ls.getItem("lastPath");t.path(e)},i.reload=function(){a.reload()},i}]),angular.module("rastros").factory("scroll",["$document",function(e){var t={};return t.toTop=function(t){var a=t||0,o=e.find("body");o.scrollTop(a,800)},t}]),angular.module("rastros").provider("moment",function(){var e;return{locale:function(t){e=t},$get:["$window",function(t){return t.moment.locale(e),t.moment}]}}),angular.module("rastros").factory("inject",["$window","config",function(e,t){var a={};return a.js=function(a,o,i){var n,s="script",r=a+"-jssdk",l=e.document,d=l.getElementsByTagName(o?o:"head")[0],c=l.getElementById(r);if(c){if("loaded"===c.readyState||"complete"===c.readyState)return;c.remove()}switch(n=l.createElement(s),n.id=r,a){case"facebook":n.src=t.FACEBOOK.SDK;break;case"accountkit":n.src=t.ACCOUNT_KIT.SDK;break;default:n.src=i?i:"none"}d.appendChild(n)},a}]),angular.module("rastros").factory("facebook",["$window","inject","config",function(e,t,a){var o={};return o.inject=function(){t.js("facebook")},o.load=function(){e.fbAsyncInit=function(){e.FB.init({appId:a.FACEBOOK.APP_ID,status:!0,cookie:!0,xfbml:!0,version:"v2.6"}),e.FB.AppEvents.logPageView()},o.inject()},o}]),angular.module("rastros").service("futliga",["$http","$q","$filter","urls",function(e,t,a,o){var i=o.CORS+o.FUTLIGA.INDEX+o.FUTLIGA.NEXT_MATCHES,n={matches:[]};return n.get=function(){var a=t.defer(),o=i;return e.get(o).then(function(e){200===e.status&&a.resolve(e.data)}).catch(function(e){a.reject(e)}),a.promise},n.nextMatches=function(){var e=t.defer();return n.get().then(function(t){e.resolve(a("futligaMatches")(t))}).catch(function(t){e.reject(t)}),e.promise},n}]),angular.module("rastros").factory("fireb",["$q",function(e){var t=firebase.database(),a={};return a.profiles={create:function(e,a){e&&a&&t.ref("profiles/"+e).set(a)},getById:function(a){if(a){var o=e.defer();return t.ref("profiles/"+a).on("value",function(e){o.resolve(e.val())}),o.promise}}},a.games={create:function(e){if(e){var a={date:e.date,teams:e.teams};delete a.date.moment;var o="games/"+e.date.id+"-"+e.id;t.ref(o).set(a)}},imIn:function(e,a){if(e&&a){var o="games/"+e.date.id+"-"+e.id+"/going/"+a.uid;t.ref(o).set({confirmStamp:moment().format("YYYY-MM-DD[T]HH:mm:ss")})}},imOut:function(e,a){if(e&&a){var o="games/"+e.date.id+"-"+e.id+"/going";t.ref(o).child(a.uid).remove()}}},a.teams={create:function(e){if(e){var a={futligaID:e.id,name:e.name,logo:e.logo,logoOld:e.logoOld};t.ref("teams/").push(a)}}},a}]),angular.module("rastros").factory("user",["$rootScope","$timeout","loader","flow",function(e,t,a,o){var i=firebase.auth(),n={data:null,test:{}};return n.isLogged=function(){var t=n.data;return t?(e.$broadcast("user:logged",t),t):null},n.create=function(e,n){var s="Cadastrando";a.start(s),i.createUserWithEmailAndPassword(e,n).catch(function(e){a.error(e.message)}),t(function(){o.goBack(),a.stop(s)},1e3)},n}]),angular.module("rastros").factory("authentication",["$rootScope","$document","$window","$q","fireb","user","loader","flow","config",function(e,t,a,o,i,n,s,r,l){var d=firebase.auth(),c={};return c.register=function(e,a){var o="Criando conta";s.start(o),d.createUserWithEmailAndPassword(e,a).then(function(){r.goBack(),s.stop(o)}).catch(function(e){s.stop(o),s.error('<div class="aph loader__content__error__title">Ué...</div>Alguma coisa deu errado tentando fazer seu cadastro, saca só:<br />'+e.message),t.find("body")[0].click()})},c.login=function(e,a){var o="Autenticando";s.start(o),d.signInWithEmailAndPassword(e,a).then(function(){r.goBack(),s.stop(o)}).catch(function(e){s.stop(o),s.error('<div class="aph loader__content__error__title">Ih, carai!</div>Alguma coisa deu errado tentando fazer seu login, saca só:<br />'+e.message),t.find("body")[0].click()})},c.logout=function(){var e="Saindo";s.start(e),d.signOut().then(function(){s.stop(e)},function(a){s.stop(e),s.error('<div class="aph loader__content__error__title">Óh azidéia...</div>Parece que não é pra você sair daqui, hein?!<br />Hehehe<br />Se liga no erro que deu, tentando fazer logout:<br />'+a.message),t.find("body")[0].click()})},c.facebook=function(){var e=new firebase.auth.FacebookAuthProvider;e.addScope(l.FACEBOOK.SCOPE),c.provider(e,"Facebook")},c.twitter=function(){var e=new firebase.auth.TwitterAuthProvider;c.provider(e,"Twitter")},c.provider=function(e,t){var a="Autenticando com "+t;s.start(a),d.signInWithRedirect(e)},c.resetPassword=function(e){var t=o.defer();return e?(d.sendPasswordResetEmail(e).then(function(){console.info("E-mail de redefinição de senha enviado"),t.resolve()},function(e){s.error('<div class="aph loader__content__error__title">Eita, fusão</div>Não deu pra enviar a mensagem de redefinição de senha por causa disso aqui, se liga:<br />'+e.message),t.reject(e)}),t.promise):(console.info("Necessário um endereço de e-mail para envio da mensagem de redefinição de senha."),t.reject(),t.promise)},c._writeUserData=function(e){if(e){var t={name:e.displayName,email:e.email,emailVerified:e.emailVerified,photoURL:e.photoURL,permission:"default"};i.profiles.create(e.uid,t)}},d.onAuthStateChanged(function(a){return t.find("body")[0].click(),a?(n.data=a,e.$broadcast("user:changed",n.data),void c._writeUserData(a)):(n.data=null,void e.$broadcast("user:changed",null))}),c}]),angular.module("rastros").controller("404Controller",["$scope","flow",function(e,t){e.goBack=function(){t.goBack()}}]),angular.module("rastros").controller("HomeController",["$rootScope","$scope","loader","flow","urls","futliga","fireb",function(e,t,a,o,i,n,s){t.nextMatches=null,t.count={},t.detailsUrl=i.FUTLIGA.INDEX+i.FUTLIGA.AGENDA_PATH,t.matches=function(){var e="Calendário da Futliga";a.start(e),n.nextMatches().then(function(e){t.nextMatches=e,t.saveGames(t.nextMatches)}).catch(function(t){a.error('Houve um problema com "'+e+'":<br />'+t.name)}).finally(function(){a.stop(e)})},t.updateCounts=function(a,o){var i=o.numChildren(),n=o.val();a.imGoing=!1,a.goingNumber=i||0,a.goingProfiles=[],angular.forEach(n,function(o,i){firebase.database().ref("profiles/"+i).once("value").then(function(e){var o=e.val();if(o){var i={uid:o.uid,name:o.name,photoURL:o.photoURL?o.photoURL:"/assets/images/icons/icon-60x60.png"};a.goingProfiles.push(i)}t.$apply()});var n=e.user;n&&i===n.uid&&(a.imGoing=!0)})},t.goingCount=function(e){var a="games/"+e.date.id+"-"+e.id+"/going";firebase.database().ref(a).on("value",function(a){t.updateCounts(e,a)})},t.imGoing=function(t){var a=e.user;return a?(t.imGoing=!0,void s.games.imIn(t,a)):void o.goTo("/entrar")},t.imNotGoing=function(t){var a=e.user;return a?(t.imGoing=!1,void s.games.imOut(t,a)):void o.goTo("/entrar")},t.saveGames=function(a){var o=e.user;if(a&&o)for(var i=0;i<a.length;i++){var n="games/"+a[i].date.id+"-"+a[i].id;t.verifyMatch(n,a[i])}},t.verifyMatch=function(e,t){firebase.database().ref(e).once("value").then(function(e){e.val()||s.games.create(t)})},t.otherPage=function(){o.goTo("/404")},t.$on("$viewContentLoaded",function(){t.matches()})}]),angular.module("rastros").controller("AuthController",["$rootScope","$scope","$window","$document","authentication","user","facebook","loader","flow",function(e,t,a,o,i,n,s,r,l){t.form={},t.facebook=function(){i.facebook()},t.twitter=function(){i.twitter()},t.login=function(){var e=t.form;e.email&&e.password&&i.login(e.email,e.password)},t.register=function(){var e=t.form;e.email&&e.password&&i.register(e.email,e.password)},t.forgetPassword=function(){t.form.email&&i.resetPassword(t.form.email)},t.$on("user:changed",function(e,a){t.user=a,t.user&&l.goBack()}),t.$on("$viewContentLoaded",function(){t.user=n.isLogged(),t.user&&l.goBack()})}]),angular.module("rastros").controller("ProfileController",["$scope","user","authentication",function(e,t,a){e.profile=t.data,e.linked={facebook:!1,twitter:!1,google:!1},e._verifyLinks=function(){if(e.profile){var t=e.profile.providerData;angular.forEach(t,function(t){switch(t.providerId){case"facebook.com":e.linked.facebook=!0;break;case"twitter.com":e.linked.twitter=!0;break;case"google.com":e.linked.google=!0;break;default:return!1}})}},e.facebookLink=function(){a.facebookLink()},e.$on("user:changed",function(t,a){e.profile=a,e._verifyLinks()}),e.$on("$viewContentLoaded",function(){})}]),angular.module("rastros").directive("navbar",["$rootScope","$window","flow","user","authentication",function(e,t,a,o,i){return{restrict:"E",scope:!0,templateUrl:"app/templates/directives/navbar-directive-template.html",link:function(e,t){t.addClass("aph navbar navbar--fixed-top"),e.goTo=function(e){var t=e||"/";a.goTo(t)}},controller:["$scope",function(t){e.user=o.data?o.data:o.isLogged(),t.$on("user:changed",function(t,a){e.user=a}),t.logout=function(){i.logout(),a.reload()}}]}}]),angular.module("rastros").directive("errorSrc",function(){return{link:function(e,t,a){t.bind("error",function(){a.src!==a.errorSrc&&a.$set("src",a.errorSrc)})}}}),angular.module("rastros").filter("unsafe",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),angular.module("rastros").filter("removeBreakLines",function(){return function(e){for(var t=e;t.match(/\r?\n|\r/);)t=t.replace(/\r?\n|\r/,"");return t}}),angular.module("rastros").filter("stringRemoveAfter",function(){return function(e,t){if(t)return t=e.indexOf(t),e.substring(0,t!==-1?t:e.length)}}),angular.module("rastros").filter("futligaMatches",["$filter",function(e){return function(t){function a(){for(var t=i.querySelectorAll(".agenda-pagina-equipe"),a=0;a<t.length;a++){var o=angular.copy(s),r=t[a].querySelector("h5"),l=t[a].querySelectorAll(".jogos-times-nome h4 a"),d=t[a].querySelector(".veja-mais").pathname;o.id=d.replace("/Agenda/","").slice(9),o.date=e("detectDate")(r.innerText),o.teams.home=e("detectTeam")(l[0]),o.teams.visitor=e("detectTeam")(l[1]),o.goingNumber=0,o.goingProfiles=null,n.push(o)}}function o(){for(var e=i.querySelectorAll("img"),t=0;t<e.length;t++)e[t].src=""}var i=document.createElement("futliga"),n=[],s={teams:{},date:{}};return i.innerHTML=t,o(),a(),n}}]),angular.module("rastros").filter("detectDate",["$filter","moment",function(e,t){return function(a){var o=e("removeBreakLines")(a).replace("     ","").replace("                     ","").replace("                ",""),i=o.slice(-19,-9),n=o.slice(-5);return i={day:i.slice(0,2),month:i.slice(3,5),year:i.slice(6,10),hour:n.slice(0,2),minute:n.slice(3,5)},i.id=i.year+i.month+i.day,i.timestamp=i.year+"-"+i.month+"-"+i.day+"T"+n+":00",i.moment=t(i.timestamp),i}}]),angular.module("rastros").filter("detectTeam",["$filter","urls",function(e,t){return function(a){var o={};return o.id=parseInt(a.href.slice(-5).replace("p","").replace("e","").replace("/","")),o.title=e("removeBreakLines")(a.innerText).replace("                            ","").replace("                        ",""),
o.logoOld=t.FUTLIGA.INDEX+t.FUTLIGA.IMAGES_PATH+o.id+".gif",o.logo=t.FUTLIGA.INDEX+t.FUTLIGA.IMAGES_PATH+o.id+"-v01.gif",o}}]),function(e,t){function a(){e.removeEventListener("load",a,!1),r=!0}function o(e){return l=l||new o.Class(e)}function i(e,t){for(var a in t)e[a]=t[a];return e}function n(){"#ath"==t.location.hash&&history.replaceState("",e.document.title,t.location.href.split("#")[0]),d.test(t.location.href)&&history.replaceState("",e.document.title,t.location.href.replace(d,"$1")),c.test(t.location.search)&&history.replaceState("",e.document.title,t.location.href.replace(c,"$2"))}var s="addEventListener"in e,r=!1;"complete"===t.readyState?r=!0:s&&e.addEventListener("load",a,!1);var l,d=/\/ath(\/)?$/,c=/([\?&]ath=[^&]*$|&ath=[^&]*(&))/;o.intl={cs_cs:{ios:"Pro přidáni této webové aplikace na úvodní obrazovku: stlačte %icon a pak <strong>Přidat na úvodní obrazovku</strong>.",android:'Pro přidáni této webové aplikace na úvodní obrazovku otevřete menu nastavení prohlížeče a stlačte <strong>Přidat na úvodní obrazovku</strong>. <small>K menu se dostanete stlačením hardwaroveho tlačítka, když ho vaše zařízení má, nebo stlačením pravé horní menu ikony <span class="ath-action-icon">icon</span>.</small>'},de_de:{ios:"Um diese Web-App zum Home-Bildschirm hinzuzufügen, tippen Sie auf %icon und dann <strong>Zum Home-Bildschirm</strong>.",android:"Um diese Web-App zum Home-Bildschirm hinzuzufügen, öffnen Sie das Menü und tippen dann auf <strong>Zum Startbildschirm hinzufügen</strong>. <small>Wenn Ihr Gerät eine Menütaste hat, lässt sich das Browsermenü über diese öffnen. Ansonsten tippen Sie auf %icon.</small>"},da_dk:{ios:"For at tilføje denne web app til hjemmeskærmen: Tryk %icon og derefter <strong>Føj til hjemmeskærm</strong>.",android:"For at tilføje denne web app til hjemmeskærmen, åbn browser egenskaber menuen og tryk på <strong>Føj til hjemmeskærm</strong>. <small>Denne menu kan tilgås ved at trykke på menu knappen, hvis din enhed har en, eller ved at trykke på det øverste højre menu ikon %icon.</small>"},el_gr:{ios:"Για να προσθέσετε την εφαρμογή στην αρχική οθόνη: πατήστε το %icon και μετά <strong>Πρόσθεσε στην αρχική οθόνη</strong>.",android:"Για να προσθέσετε την εφαρμογή στην αρχική οθόνη, ανοίξτε τις επιλογές του browser σας και πατήστε το <strong>Προσθήκη στην αρχική οθόνη</strong>. <small>Μπορείτε να έχετε πρόσβαση στο μενού, πατώντας το κουμπί του μενού του κινητού σας ή το πάνω δεξιά κουμπί του μενού %icon.</small>"},en_us:{ios:"To add this web app to the home screen: tap %icon and then <strong>Add to Home Screen</strong>.",android:"To add this web app to the home screen open the browser option menu and tap on <strong>Add to homescreen</strong>. <small>The menu can be accessed by pressing the menu hardware button if your device has one, or by tapping the top right menu icon %icon.</small>"},es_es:{ios:"Para añadir esta aplicación web a la pantalla de inicio: pulsa %icon y selecciona <strong>Añadir a pantalla de inicio</strong>.",android:"Para añadir esta aplicación web a la pantalla de inicio, abre las opciones y pulsa <strong>Añadir a pantalla inicio</strong>. <small>El menú se puede acceder pulsando el botón táctil en caso de tenerlo, o bien el icono de la parte superior derecha de la pantalla %icon.</small>"},fi_fi:{ios:"Liitä tämä sovellus kotivalikkoon: klikkaa %icon ja tämän jälkeen <strong>Lisää kotivalikkoon</strong>.",android:"Lisätäksesi tämän sovelluksen aloitusnäytölle, avaa selaimen valikko ja klikkaa tähti -ikonia tai <strong>Lisää aloitusnäytölle tekstiä</strong>. <small>Valikkoon pääsee myös painamalla menuvalikkoa, jos laitteessasi on sellainen tai koskettamalla oikealla yläkulmassa menu ikonia %icon.</small>"},fr_fr:{ios:"Pour ajouter cette application web sur l'écran d'accueil : Appuyez %icon et sélectionnez <strong>Ajouter sur l'écran d'accueil</strong>.",android:'Pour ajouter cette application web sur l\'écran d\'accueil : Appuyez sur le bouton "menu", puis sur <strong>Ajouter sur l\'écran d\'accueil</strong>. <small>Le menu peut-être accessible en appuyant sur le bouton "menu" du téléphone s\'il en possède un <i class="fa fa-bars"></i>. Sinon, il se trouve probablement dans la coin supérieur droit du navigateur %icon.</small>'},he_il:{ios:'<span dir="rtl">להוספת האפליקציה למסך הבית: ללחוץ על %icon ואז <strong>הוסף למסך הבית</strong>.</span>',android:"To add this web app to the home screen open the browser option menu and tap on <strong>Add to homescreen</strong>. <small>The menu can be accessed by pressing the menu hardware button if your device has one, or by tapping the top right menu icon %icon.</small>"},hu_hu:{ios:"Ha hozzá szeretné adni ezt az alkalmazást a kezdőképernyőjéhez, érintse meg a következő ikont: %icon , majd a <strong>Hozzáadás a kezdőképernyőhöz</strong> menüpontot.",android:"Ha hozzá szeretné adni ezt az alkalmazást a kezdőképernyőjéhez, a böngésző menüjében kattintson a <strong>Hozzáadás a kezdőképernyőhöz</strong> menüpontra. <small>A böngésző menüjét a következő ikon megérintésével tudja megnyitni: %icon.</small>"},it_it:{ios:"Per aggiungere questa web app alla schermata iniziale: premi %icon e poi <strong>Aggiungi a Home</strong>.",android:"Per aggiungere questa web app alla schermata iniziale, apri il menu opzioni del browser e premi su <strong>Aggiungi alla homescreen</strong>. <small>Puoi accedere al menu premendo il pulsante hardware delle opzioni se la tua device ne ha uno, oppure premendo l'icona %icon in alto a destra.</small>"},ja_jp:{ios:"このウェプアプリをホーム画面に追加するには、%iconをタップして<strong>ホーム画面に追加</strong>してください。",android:"このウェプアプリをホーム画面に追加するには、ブラウザのオプションメニューから<strong>ホーム画面に追加</strong>をタップしてください。<small>オプションメニューは、一部の機種ではデバイスのメニューボタンから、それ以外では画面右上の%iconからアクセスできます。</small>"},ko_kr:{ios:"홈 화면에 바로가기 생성: %icon 을 클릭한 후 <strong>홈 화면에 추가</strong>.",android:"브라우저 옵션 메뉴의 <string>홈 화면에 추가</string>를 클릭하여 홈화면에 바로가기를 생성할 수 있습니다. <small>옵션 메뉴는 장치의 메뉴 버튼을 누르거나 오른쪽 상단의 메뉴 아이콘 %icon을 클릭하여 접근할 수 있습니다.</small>"},nb_no:{ios:"For å installere denne appen på hjem-skjermen: trykk på %icon og deretter <strong>Legg til på Hjem-skjerm</strong>.",android:"For å legge til denne webappen på startsiden åpner en nettlesermenyen og velger <strong>Legg til på startsiden</strong>. <small>Menyen åpnes ved å trykke på den fysiske menyknappen hvis enheten har det, eller ved å trykke på menyikonet øverst til høyre %icon.</small>"},pt_br:{ios:"Para adicionar este app à tela de início: clique %icon e então <strong>Tela de início</strong>.",android:'Para adicionar este app à tela de início, abra o menu de opções do navegador e selecione <strong>Adicionar à tela inicial</strong>. <small>O menu pode ser acessado pressionando o "menu" button se o seu dispositivo tiver um, ou selecionando o ícone %icon no canto superior direito.</small>'},pt_pt:{ios:"Para adicionar esta app ao ecrã principal: clique %icon e depois <strong>Ecrã principal</strong>.",android:'Para adicionar esta app web ecrã principal, abra o menu de opções do navegador e selecione <strong>Adicionar à tela inicial</strong>. <small>O menu pode ser acessado pressionando o "menu" button se o seu dispositivo tiver um, ou selecionando o ícone %icon no canto superior direito.</small>'},nl_nl:{ios:"Om deze webapp aan je startscherm toe te voegen, klik op %icon en dan <strong>Zet in startscherm</strong>.",android:'Om deze webapp aan je startscherm toe te voegen, open de browserinstellingen en tik op <strong>Toevoegen aan startscherm</strong>. <small>Gebruik de "menu" knop als je telefoon die heeft, anders het menu-icoon rechtsbovenin %icon.</small>'},ru_ru:{ios:'Чтобы добавить этот сайт на свой домашний экран, нажмите на иконку %icon и затем <strong>На экран "Домой"</strong>.',android:"Чтобы добавить сайт на свой домашний экран, откройте меню браузера и нажмите на <strong>Добавить на главный экран</strong>. <small>Меню можно вызвать, нажав на кнопку меню вашего телефона, если она есть. Или найдите иконку сверху справа %icon[иконка].</small>"},sk_sk:{ios:"Pre pridanie tejto webovej aplikácie na úvodnú obrazovku: stlačte %icon a potom <strong>Pridať na úvodnú obrazovku</strong>.",android:'Pre pridanie tejto webovej aplikácie na úvodnú obrazovku otvorte menu nastavenia prehliadača a stlačte <strong>Pridať na úvodnú obrazovku</strong>. <small>K menu sa dostanete stlačením hardwaroveho tlačidla, ak ho vaše zariadenie má, alebo stlačením pravej hornej menu ikony <span class="ath-action-icon">icon</span>.</small>'},sv_se:{ios:"För att lägga till denna webbapplikation på hemskärmen: tryck på %icon och därefter <strong>Lägg till på hemskärmen</strong>.",android:"För att lägga till den här webbappen på hemskärmen öppnar du webbläsarens alternativ-meny och väljer <strong>Lägg till på startskärmen</strong>. <small>Man hittar menyn genom att trycka på hårdvaruknappen om din enhet har en sådan, eller genom att trycka på menyikonen högst upp till höger %icon.</small>"},tr_tr:{ios:"Uygulamayı ana ekrana eklemek için, %icon ve ardından <strong>ana ekrana ekle</strong> butonunu tıklayın.",android:"Uygulamayı ana ekrana eklemek için, menüye girin ve <strong>ana ekrana ekle</strong> butonunu tıklayın. <small>Cihazınız menü tuşuna sahip ise menüye girmek için menü tuşunu tıklayın. Aksi takdirde %icon butonunu tıklayın.</small>"},uk_ua:{ios:"Щоб додати цей сайт на початковий екран, натисніть %icon, а потім <strong>На початковий екран</strong>.",android:"Щоб додати цей сайт на домашній екран, відкрийте меню браузера та виберіть <strong>Додати на головний екран</strong>. <small>Це можливо зробити, натиснувши кнопку меню на вашому смартфоні, якщо така є. Або ж на іконці зверху справа %icon.</small>"},zh_cn:{ios:"如要把应用程序加至主屏幕,请点击%icon, 然后<strong>添加到主屏幕</strong>",android:"To add this web app to the home screen open the browser option menu and tap on <strong>Add to homescreen</strong>. <small>The menu can be accessed by pressing the menu hardware button if your device has one, or by tapping the top right menu icon %icon.</small>"},zh_tw:{ios:"如要把應用程式加至主屏幕, 請點擊%icon, 然後<strong>加至主屏幕</strong>.",android:"To add this web app to the home screen open the browser option menu and tap on <strong>Add to homescreen</strong>. <small>The menu can be accessed by pressing the menu hardware button if your device has one, or by tapping the top right menu icon %icon.</small>"}};for(var m in o.intl)o.intl[m.substr(0,2)]=o.intl[m];o.defaults={appID:"org.cubiq.addtohome",fontSize:15,debug:!1,logging:!1,modal:!1,mandatory:!1,autostart:!0,skipFirstVisit:!1,startDelay:1,lifespan:15,displayPace:1440,maxDisplayCount:0,icon:!0,message:"",validLocation:[],onInit:null,onShow:null,onRemove:null,onAdd:null,onPrivate:null,privateModeOverride:!1,detectHomescreen:!1};var p=e.navigator.userAgent,h=e.navigator;i(o,{hasToken:"#ath"==t.location.hash||d.test(t.location.href)||c.test(t.location.search),isRetina:e.devicePixelRatio&&e.devicePixelRatio>1,isIDevice:/iphone|ipod|ipad/i.test(p),isMobileChrome:p.indexOf("Android")>-1&&/Chrome\/[.0-9]*/.test(p)&&p.indexOf("Version")==-1,isMobileIE:p.indexOf("Windows Phone")>-1,language:h.language&&h.language.toLowerCase().replace("-","_")||""}),o.language=o.language&&o.language in o.intl?o.language:"en_us",o.isMobileSafari=o.isIDevice&&p.indexOf("Safari")>-1&&p.indexOf("CriOS")<0,o.OS=o.isIDevice?"ios":o.isMobileChrome?"android":o.isMobileIE?"windows":"unsupported",o.OSVersion=p.match(/(OS|Android) (\d+[_\.]\d+)/),o.OSVersion=o.OSVersion&&o.OSVersion[2]?+o.OSVersion[2].replace("_","."):0,o.isStandalone="standalone"in e.navigator&&e.navigator.standalone,o.isTablet=o.isMobileSafari&&p.indexOf("iPad")>-1||o.isMobileChrome&&p.indexOf("Mobile")<0,o.isCompatible=o.isMobileSafari&&o.OSVersion>=6||o.isMobileChrome;var u={lastDisplayTime:0,returningVisitor:!1,displayCount:0,optedout:!1,added:!1};o.removeSession=function(e){try{if(!localStorage)throw new Error("localStorage is not defined");localStorage.removeItem(e||o.defaults.appID)}catch(e){}},o.doLog=function(e){this.options.logging&&console.log(e)},o.Class=function(a){if(this.doLog=o.doLog,this.options=i({},o.defaults),i(this.options,a),this.options&&this.options.debug&&"undefined"==typeof this.options.logging&&(this.options.logging=!0),s){if(this.options.mandatory=this.options.mandatory&&("standalone"in e.navigator||this.options.debug),this.options.modal=this.options.modal||this.options.mandatory,this.options.mandatory&&(this.options.startDelay=-.5),this.options.detectHomescreen=this.options.detectHomescreen===!0?"hash":this.options.detectHomescreen,this.options.debug&&(o.isCompatible=!0,o.OS="string"==typeof this.options.debug?this.options.debug:"unsupported"==o.OS?"android":o.OS,o.OSVersion="ios"==o.OS?"8":"4"),this.container=t.body,this.session=this.getItem(this.options.appID),this.session=this.session?JSON.parse(this.session):void 0,!o.hasToken||o.isCompatible&&this.session||(o.hasToken=!1,n()),!o.isCompatible)return void this.doLog("Add to homescreen: not displaying callout because device not supported");this.session=this.session||u;try{if(!localStorage)throw new Error("localStorage is not defined");localStorage.setItem(this.options.appID,JSON.stringify(this.session)),o.hasLocalStorage=!0}catch(e){o.hasLocalStorage=!1,this.options.onPrivate&&this.options.onPrivate.call(this)}for(var r=!this.options.validLocation.length,l=this.options.validLocation.length;l--;)if(this.options.validLocation[l].test(t.location.href)){r=!0;break}if(this.getItem("addToHome")&&this.optOut(),this.session.optedout)return void this.doLog("Add to homescreen: not displaying callout because user opted out");if(this.session.added)return void this.doLog("Add to homescreen: not displaying callout because already added to the homescreen");if(!r)return void this.doLog("Add to homescreen: not displaying callout because not a valid location");if(o.isStandalone)return this.session.added||(this.session.added=!0,this.updateSession(),this.options.onAdd&&o.hasLocalStorage&&this.options.onAdd.call(this)),void this.doLog("Add to homescreen: not displaying callout because in standalone mode");if(this.options.detectHomescreen){if(o.hasToken)return n(),this.session.added||(this.session.added=!0,this.updateSession(),this.options.onAdd&&o.hasLocalStorage&&this.options.onAdd.call(this)),void this.doLog("Add to homescreen: not displaying callout because URL has token, so we are likely coming from homescreen");"hash"==this.options.detectHomescreen?history.replaceState("",e.document.title,t.location.href+"#ath"):"smartURL"==this.options.detectHomescreen?history.replaceState("",e.document.title,t.location.href.replace(/(\/)?$/,"/ath$1")):history.replaceState("",e.document.title,t.location.href+(t.location.search?"&":"?")+"ath=")}if(!this.session.returningVisitor&&(this.session.returningVisitor=!0,this.updateSession(),this.options.skipFirstVisit))return void this.doLog("Add to homescreen: not displaying callout because skipping first visit");if(!this.options.privateModeOverride&&!o.hasLocalStorage)return void this.doLog("Add to homescreen: not displaying callout because browser is in private mode");this.ready=!0,this.options.onInit&&this.options.onInit.call(this),this.options.autostart&&(this.doLog("Add to homescreen: autostart displaying callout"),this.show())}},o.Class.prototype={events:{load:"_delayedShow",error:"_delayedShow",orientationchange:"resize",resize:"resize",scroll:"resize",click:"remove",touchmove:"_preventDefault",transitionend:"_removeElements",webkitTransitionEnd:"_removeElements",MSTransitionEnd:"_removeElements"},handleEvent:function(e){var t=this.events[e.type];t&&this[t](e)},show:function(a){if(this.options.autostart&&!r)return void setTimeout(this.show.bind(this),50);if(this.shown)return void this.doLog("Add to homescreen: not displaying callout because already shown on screen");var i=Date.now(),n=this.session.lastDisplayTime;if(a!==!0){if(!this.ready)return void this.doLog("Add to homescreen: not displaying callout because not ready");if(i-n<6e4*this.options.displayPace)return void this.doLog("Add to homescreen: not displaying callout because displayed recently");if(this.options.maxDisplayCount&&this.session.displayCount>=this.options.maxDisplayCount)return void this.doLog("Add to homescreen: not displaying callout because displayed too many times already")}this.shown=!0,this.session.lastDisplayTime=i,this.session.displayCount++,this.updateSession(),this.applicationIcon||("ios"==o.OS?this.applicationIcon=t.querySelector('head link[rel^=apple-touch-icon][sizes="152x152"],head link[rel^=apple-touch-icon][sizes="144x144"],head link[rel^=apple-touch-icon][sizes="120x120"],head link[rel^=apple-touch-icon][sizes="114x114"],head link[rel^=apple-touch-icon]'):this.applicationIcon=t.querySelector('head link[rel^="shortcut icon"][sizes="196x196"],head link[rel^=apple-touch-icon]'));var s="";"object"==typeof this.options.message&&o.language in this.options.message?s=this.options.message[o.language][o.OS]:"object"==typeof this.options.message&&o.OS in this.options.message?s=this.options.message[o.OS]:this.options.message in o.intl?s=o.intl[this.options.message][o.OS]:""!==this.options.message?s=this.options.message:o.OS in o.intl[o.language]&&(s=o.intl[o.language][o.OS]),s="<p>"+s.replace(/%icon(?:\[([^\]]+)\])?/gi,function(e,t){return'<span class="ath-action-icon">'+(t?t:"icon")+"</span>"})+"</p>",this.viewport=t.createElement("div"),this.viewport.className="ath-viewport",this.options.modal&&(this.viewport.className+=" ath-modal"),this.options.mandatory&&(this.viewport.className+=" ath-mandatory"),this.viewport.style.position="absolute",this.element=t.createElement("div"),this.element.className="ath-container ath-"+o.OS+" ath-"+o.OS+(parseInt(o.OSVersion)||"")+" ath-"+(o.isTablet?"tablet":"phone"),this.element.style.cssText="-webkit-transition-property:-webkit-transform,opacity;-webkit-transition-duration:0s;-webkit-transition-timing-function:ease-out;transition-property:transform,opacity;transition-duration:0s;transition-timing-function:ease-out;",this.element.style.webkitTransform="translate3d(0,-"+e.innerHeight+"px,0)",this.element.style.transform="translate3d(0,-"+e.innerHeight+"px,0)",this.options.icon&&this.applicationIcon&&(this.element.className+=" ath-icon",this.img=t.createElement("img"),this.img.className="ath-application-icon",this.img.addEventListener("load",this,!1),this.img.addEventListener("error",this,!1),this.img.src=this.applicationIcon.href,this.element.appendChild(this.img)),this.element.innerHTML+=s,this.viewport.style.left="-99999em",this.viewport.appendChild(this.element),this.container.appendChild(this.viewport),this.img?this.doLog("Add to homescreen: not displaying callout because waiting for img to load"):this._delayedShow()},_delayedShow:function(e){setTimeout(this._show.bind(this),1e3*this.options.startDelay+500)},_show:function(){var a=this;this.updateViewport(),e.addEventListener("resize",this,!1),e.addEventListener("scroll",this,!1),e.addEventListener("orientationchange",this,!1),this.options.modal&&t.addEventListener("touchmove",this,!0),this.options.mandatory||setTimeout(function(){a.element.addEventListener("click",a,!0)},1e3),setTimeout(function(){a.element.style.webkitTransitionDuration="1.2s",a.element.style.transitionDuration="1.2s",a.element.style.webkitTransform="translate3d(0,0,0)",a.element.style.transform="translate3d(0,0,0)"},0),this.options.lifespan&&(this.removeTimer=setTimeout(this.remove.bind(this),1e3*this.options.lifespan)),this.options.onShow&&this.options.onShow.call(this)},remove:function(){clearTimeout(this.removeTimer),this.img&&(this.img.removeEventListener("load",this,!1),this.img.removeEventListener("error",this,!1)),e.removeEventListener("resize",this,!1),e.removeEventListener("scroll",this,!1),e.removeEventListener("orientationchange",this,!1),t.removeEventListener("touchmove",this,!0),this.element.removeEventListener("click",this,!0),this.element.addEventListener("transitionend",this,!1),this.element.addEventListener("webkitTransitionEnd",this,!1),this.element.addEventListener("MSTransitionEnd",this,!1),this.element.style.webkitTransitionDuration="0.3s",this.element.style.opacity="0"},_removeElements:function(){this.element.removeEventListener("transitionend",this,!1),this.element.removeEventListener("webkitTransitionEnd",this,!1),this.element.removeEventListener("MSTransitionEnd",this,!1),this.container.removeChild(this.viewport),this.shown=!1,this.options.onRemove&&this.options.onRemove.call(this)},updateViewport:function(){if(this.shown){this.viewport.style.width=e.innerWidth+"px",this.viewport.style.height=e.innerHeight+"px",this.viewport.style.left=e.scrollX+"px",this.viewport.style.top=e.scrollY+"px";var a=t.documentElement.clientWidth;this.orientation=a>t.documentElement.clientHeight?"landscape":"portrait";var i="ios"==o.OS?"portrait"==this.orientation?screen.width:screen.height:screen.width;this.scale=screen.width>a?1:i/e.innerWidth,this.element.style.fontSize=this.options.fontSize/this.scale+"px"}},resize:function(){clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(this.updateViewport.bind(this),100)},updateSession:function(){o.hasLocalStorage!==!1&&localStorage&&localStorage.setItem(this.options.appID,JSON.stringify(this.session))},clearSession:function(){this.session=u,this.updateSession()},getItem:function(e){try{if(!localStorage)throw new Error("localStorage is not defined");return localStorage.getItem(e)}catch(e){o.hasLocalStorage=!1}},optOut:function(){this.session.optedout=!0,this.updateSession()},optIn:function(){this.session.optedout=!1,this.updateSession()},clearDisplayCount:function(){this.session.displayCount=0,this.updateSession()},_preventDefault:function(e){e.preventDefault(),e.stopPropagation()}},e.addToHomescreen=o}(window,document);